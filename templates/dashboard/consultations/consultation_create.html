{% extends "dashboard_base.html" %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load consultations_tags %}

{% block sheri %}
<div class="container py-3">
    <h2 class="mb-4">{% trans "Add New Consultation" %}</h2>

    <form method="post">
        {% csrf_token %}
        {{ form.media }}  <!-- Loads JS/CSS for CKEditor -->
        <div class="row">
            <div class="col-md-6">
                {{ form.patient|as_crispy_field }}
            </div>
            <div class="col-md-6">
                {{ form.status|as_crispy_field }}
            </div>
        </div>

        <div class="mb-3">
            {{ form.title|as_crispy_field }}
        </div>

        <div class="mb-3">
            {{ form.medical_case|as_crispy_field }}
        </div>
        <button type="submit" class="btn btn-primary mt-3">{% trans "Save" %}</button>
        <a href="{% url 'consultation_list' %}" class="btn btn-secondary mt-3">{% trans "Cancel" %}</a>
    </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    Hideffcanvas();
  });
</script>

<style>
.select2-selection {
    min-height: 38px; /* same as bootstrap form-control */
    padding: 6px 12px;
}
.select2-selection span {
    line-height: 1.2 !important;
}
</style>

<!-- Fixed floating button -->
<div style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; text-align: center;">

    <!-- Hidden circular menu buttons -->
    <div id="menuDropdown" style="display:none; margin-top:10px;">
        {% get_all_shortcuts as items %}
        {% for item in items %}
        <button class="btn btn-success rounded-circle mb-2" style="width:50px; height:50px;" data-code="{{item.code}}">
            <i class="bi {{ item.ico }} text-white fs-4"></i>
        </button><br>
        {% endfor %}
    </div>

    <!-- Main floating button -->
    <button id="menuButton" class="btn btn-primary rounded-circle" style="width:60px; height:60px; font-size:24px;">
        â˜°
    </button>
</div>

<script>
document.getElementById('menuButton').addEventListener('click', function() {
    const menu = document.getElementById('menuDropdown');
    // toggle menu
    if(menu.style.display === 'none') {
        menu.style.display = 'block';
    } else {
        menu.style.display = 'none';
    }
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // get all shortcut buttons
    const shortcutButtons = document.querySelectorAll('#menuDropdown button');

    // Assume Froala is attached to the field id_medical_case
    const editorInstance = new FroalaEditor('#id_medical_case'); // adjust selector if different

    shortcutButtons.forEach(button => {
        button.addEventListener('click', function() {
            const code = this.dataset.code;

            if(editorInstance) {
                // insert text at cursor
                editorInstance.html.insert(code + '<br>'); 
                editorInstance.events.focus(); // focus editor
            }
        });
    });
});
</script>

{% endblock %}
